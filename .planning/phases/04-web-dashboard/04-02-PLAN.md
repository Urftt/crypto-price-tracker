---
phase: 04-web-dashboard
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/crypto_price_tracker/static/index.html
  - src/crypto_price_tracker/static/style.css
  - src/crypto_price_tracker/static/app.js
autonomous: true
requirements:
  - WEB-02
  - WEB-03

must_haves:
  truths:
    - "Opening http://localhost:8000 in a browser shows a price table with rank, symbol, name, price (EUR), 24h change %, and volume"
    - "The dashboard auto-refreshes prices every 30 seconds without manual page reload"
    - "Clicking a coin row shows a detail view with expanded information for that coin"
    - "Positive 24h changes are displayed in green and negative changes in red"
    - "The dashboard is responsive and readable on both desktop and mobile viewports"
  artifacts:
    - path: "src/crypto_price_tracker/static/index.html"
      provides: "Single-page HTML dashboard with price table and coin detail modal"
      min_lines: 40
    - path: "src/crypto_price_tracker/static/style.css"
      provides: "CSS styling for price table, color-coded changes, responsive layout"
      min_lines: 50
    - path: "src/crypto_price_tracker/static/app.js"
      provides: "JavaScript for fetching prices, rendering table, auto-refresh, and coin detail view"
      min_lines: 80
  key_links:
    - from: "src/crypto_price_tracker/static/app.js"
      to: "/api/prices"
      via: "fetch() call to load price data into the table"
      pattern: "fetch.*api/prices"
    - from: "src/crypto_price_tracker/static/app.js"
      to: "/api/coin/"
      via: "fetch() call to load single coin detail data"
      pattern: "fetch.*api/coin"
    - from: "src/crypto_price_tracker/static/index.html"
      to: "src/crypto_price_tracker/static/style.css"
      via: "link rel stylesheet"
      pattern: "link.*style\\.css"
    - from: "src/crypto_price_tracker/static/index.html"
      to: "src/crypto_price_tracker/static/app.js"
      via: "script src"
      pattern: "script.*app\\.js"
---

<objective>
Build the browser-based frontend for the crypto price tracker dashboard using vanilla HTML, CSS, and JavaScript.

Purpose: This is the presentation layer of the web dashboard. It fetches price data from the JSON API (created in Plan 04-01) and renders it as an auto-refreshing price table with clickable coin detail views. No frontend framework required — vanilla JS keeps the dependency footprint minimal and consistent with the project's philosophy.

Output: A `static/` directory containing `index.html`, `style.css`, and `app.js` that together provide a fully functional, auto-refreshing crypto price dashboard.
</objective>

<execution_context>
@/home/james-turing/.claude/get-shit-done/workflows/execute-plan.md
@/home/james-turing/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-web-dashboard/04-01-SUMMARY.md
</context>

<interfaces>
<!-- From Plan 04-01 — the JSON API endpoints this frontend consumes -->

GET /api/prices?top=N
Response: JSON array of objects:
```json
[
  {
    "symbol": "BTC",
    "name": "Bitcoin",
    "price": 56754.0,
    "change_24h": 1.67,
    "volume": 2186.73,
    "volume_eur": 120339407.0
  },
  ...
]
```

GET /api/coin/{symbol}
Response: JSON object:
```json
{
  "symbol": "BTC",
  "name": "Bitcoin",
  "price": 56754.0,
  "change_24h": 1.67,
  "volume": 2186.73,
  "volume_eur": 120339407.0
}
```

<!-- Static files are served from /static/ by FastAPI -->
<!-- index.html is served at / via a dedicated route -->
</interfaces>

<tasks>

<task type="auto">
  <name>Task 1: Create the HTML structure and CSS styling for the dashboard</name>
  <files>src/crypto_price_tracker/static/index.html, src/crypto_price_tracker/static/style.css</files>
  <action>
**Step 1: Create the static directory**

```bash
mkdir -p src/crypto_price_tracker/static
```

**Step 2: Create `src/crypto_price_tracker/static/index.html`**

A single-page HTML file with:

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Price Tracker</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Crypto Prices (EUR)</h1>
            <div class="controls">
                <label for="top-n">Show top:</label>
                <select id="top-n">
                    <option value="10">10</option>
                    <option value="20" selected>20</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
                <span id="refresh-status" class="status">Refreshing...</span>
            </div>
        </header>

        <table id="price-table">
            <thead>
                <tr>
                    <th class="col-rank">#</th>
                    <th class="col-symbol">Symbol</th>
                    <th class="col-name">Name</th>
                    <th class="col-price">Price (EUR)</th>
                    <th class="col-change">24h %</th>
                    <th class="col-volume">Volume (EUR)</th>
                </tr>
            </thead>
            <tbody id="price-body">
                <!-- Populated by JavaScript -->
            </tbody>
        </table>

        <!-- Modal overlay for coin detail -->
        <div id="coin-modal" class="modal hidden">
            <div class="modal-content">
                <button class="modal-close" id="modal-close">&times;</button>
                <div id="coin-detail">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>

        <footer>
            <span id="last-updated">Loading...</span>
            <span>Auto-refreshes every <span id="interval-display">30</span>s</span>
        </footer>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
```

**Step 3: Create `src/crypto_price_tracker/static/style.css`**

Style the dashboard with a dark theme (matches typical crypto dashboards):

```css
/* Reset and base */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    background-color: #0d1117;
    color: #c9d1d9;
    line-height: 1.5;
}

.container {
    max-width: 960px;
    margin: 0 auto;
    padding: 1.5rem 1rem;
}

/* Header */
header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
    gap: 0.5rem;
}

header h1 {
    font-size: 1.5rem;
    color: #f0f6fc;
}

.controls {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
}

.controls label {
    color: #8b949e;
}

.controls select {
    background: #161b22;
    color: #c9d1d9;
    border: 1px solid #30363d;
    border-radius: 4px;
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
}

.status {
    color: #8b949e;
    font-size: 0.75rem;
}

/* Price table */
#price-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
}

#price-table thead th {
    text-align: left;
    padding: 0.75rem 0.5rem;
    border-bottom: 1px solid #30363d;
    color: #8b949e;
    font-weight: 600;
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

#price-table tbody tr {
    border-bottom: 1px solid #21262d;
    cursor: pointer;
    transition: background-color 0.15s;
}

#price-table tbody tr:hover {
    background-color: #161b22;
}

#price-table tbody td {
    padding: 0.625rem 0.5rem;
}

/* Column alignment */
.col-rank, td:nth-child(1) { text-align: right; width: 3rem; color: #8b949e; }
.col-symbol, td:nth-child(2) { font-weight: 700; color: #f0f6fc; }
.col-price, td:nth-child(4) { text-align: right; font-variant-numeric: tabular-nums; }
.col-change, td:nth-child(5) { text-align: right; font-weight: 600; font-variant-numeric: tabular-nums; }
.col-volume, td:nth-child(6) { text-align: right; color: #8b949e; font-variant-numeric: tabular-nums; }

/* Color-coded changes */
.change-positive { color: #3fb950; }
.change-negative { color: #f85149; }
.change-zero { color: #8b949e; }

/* Modal */
.modal {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 100;
}

.modal.hidden { display: none; }

.modal-content {
    background: #161b22;
    border: 1px solid #30363d;
    border-radius: 8px;
    padding: 1.5rem;
    min-width: 320px;
    max-width: 480px;
    position: relative;
}

.modal-close {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    background: none;
    border: none;
    color: #8b949e;
    font-size: 1.5rem;
    cursor: pointer;
    line-height: 1;
}

.modal-close:hover { color: #f0f6fc; }

#coin-detail h2 {
    font-size: 1.25rem;
    margin-bottom: 1rem;
    color: #f0f6fc;
}

#coin-detail .detail-row {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem 0;
    border-bottom: 1px solid #21262d;
}

#coin-detail .detail-row:last-child { border-bottom: none; }

#coin-detail .detail-label { color: #8b949e; }
#coin-detail .detail-value { font-weight: 600; font-variant-numeric: tabular-nums; }

/* Footer */
footer {
    margin-top: 1.5rem;
    display: flex;
    justify-content: space-between;
    font-size: 0.75rem;
    color: #484f58;
}

/* Responsive */
@media (max-width: 640px) {
    header { flex-direction: column; align-items: flex-start; }
    .col-volume, td:nth-child(6), th:nth-child(6) { display: none; }
    #price-table { font-size: 0.8rem; }
    .container { padding: 1rem 0.5rem; }
}
```

**Design decisions:**
- Dark theme (#0d1117 background) — standard for crypto dashboards, easier on the eyes
- System font stack — no custom fonts to load
- Green (#3fb950) for positive, Red (#f85149) for negative changes — matches GitHub dark theme palette
- Volume column hidden on mobile to keep the table readable
- Tabular numeric font variant for aligned numbers
- Modal for coin detail — no page navigation needed
- Hover state on table rows indicates they are clickable
  </action>
  <verify>
    <automated>cd /home/james-turing/repos/crypto-price-tracker-v2 && test -f src/crypto_price_tracker/static/index.html && test -f src/crypto_price_tracker/static/style.css && grep -q "price-table" src/crypto_price_tracker/static/index.html && grep -q "change-positive" src/crypto_price_tracker/static/style.css && echo "PASS" || echo "FAIL"</automated>
  </verify>
  <done>index.html contains the page structure with price table, coin detail modal, controls, and footer. style.css provides dark theme styling with color-coded changes (green positive, red negative), responsive layout, and modal overlay. Both files reference each other correctly via /static/ paths.</done>
</task>

<task type="auto">
  <name>Task 2: Create the JavaScript application for data fetching, rendering, and auto-refresh</name>
  <files>src/crypto_price_tracker/static/app.js</files>
  <action>
Create `src/crypto_price_tracker/static/app.js` — the single JavaScript file that powers the dashboard. No build tools, no npm, no frameworks — vanilla JS only.

**Structure:**

```javascript
// Configuration
const REFRESH_INTERVAL = 30; // seconds
let refreshTimer = null;

// DOM references (cached at load)
const priceBody = document.getElementById("price-body");
const topNSelect = document.getElementById("top-n");
const refreshStatus = document.getElementById("refresh-status");
const lastUpdated = document.getElementById("last-updated");
const intervalDisplay = document.getElementById("interval-display");
const coinModal = document.getElementById("coin-modal");
const coinDetail = document.getElementById("coin-detail");
const modalClose = document.getElementById("modal-close");
```

**Function `formatEur(value, decimals = 2)`:**
- Return `"EUR " + value.toLocaleString("en-US", { minimumFractionDigits: decimals, maximumFractionDigits: decimals })`
- Use en-US locale for consistent comma separators regardless of browser locale

**Function `formatChange(value)`:**
- Return `(value >= 0 ? "+" : "") + value.toFixed(2) + "%"`
- Prefix with + for positive values

**Function `changeClass(value)`:**
- If `value > 0` return `"change-positive"`
- If `value < 0` return `"change-negative"`
- Else return `"change-zero"`

**Function `async fetchPrices()`:**
- Get selected top-N value from the select element
- `const response = await fetch("/api/prices?top=" + topN)`
- If not ok, throw an error
- Return `response.json()`

**Function `async fetchCoin(symbol)`:**
- `const response = await fetch("/api/coin/" + encodeURIComponent(symbol))`
- If not ok, throw an error
- Return `response.json()`

**Function `renderTable(coins)`:**
- Clear `priceBody.innerHTML = ""`
- For each coin (index from 0), create a table row:
  ```javascript
  const tr = document.createElement("tr");
  tr.addEventListener("click", () => showCoinDetail(coin.symbol));
  tr.innerHTML = `
      <td>${index + 1}</td>
      <td>${coin.symbol}</td>
      <td>${coin.name}</td>
      <td>${formatEur(coin.price)}</td>
      <td class="${changeClass(coin.change_24h)}">${formatChange(coin.change_24h)}</td>
      <td>${formatEur(coin.volume_eur, 0)}</td>
  `;
  priceBody.appendChild(tr);
  ```
- Update `lastUpdated.textContent = "Last updated: " + new Date().toLocaleTimeString()`

**Function `async showCoinDetail(symbol)`:**
- Set `refreshStatus.textContent = "Loading..."`
- Fetch coin data: `const coin = await fetchCoin(symbol)`
- Populate the modal:
  ```javascript
  coinDetail.innerHTML = `
      <h2>${coin.symbol} — ${coin.name}</h2>
      <div class="detail-row">
          <span class="detail-label">Price</span>
          <span class="detail-value">${formatEur(coin.price)}</span>
      </div>
      <div class="detail-row">
          <span class="detail-label">24h Change</span>
          <span class="detail-value ${changeClass(coin.change_24h)}">${formatChange(coin.change_24h)}</span>
      </div>
      <div class="detail-row">
          <span class="detail-label">Volume</span>
          <span class="detail-value">${coin.volume.toLocaleString("en-US", { minimumFractionDigits: 4 })}</span>
      </div>
      <div class="detail-row">
          <span class="detail-label">Volume (EUR)</span>
          <span class="detail-value">${formatEur(coin.volume_eur, 0)}</span>
      </div>
  `;
  ```
- Show modal: `coinModal.classList.remove("hidden")`
- Reset status: `refreshStatus.textContent = ""`

**Function `closeModal()`:**
- `coinModal.classList.add("hidden")`

**Function `async refresh()`:**
- Set `refreshStatus.textContent = "Refreshing..."`
- Try:
  - `const coins = await fetchPrices()`
  - `renderTable(coins)`
  - `refreshStatus.textContent = ""`
- Catch error:
  - `refreshStatus.textContent = "Error — retrying..."`
  - `console.error("Fetch error:", error)`

**Function `startAutoRefresh()`:**
- Clear any existing timer: `if (refreshTimer) clearInterval(refreshTimer)`
- `intervalDisplay.textContent = REFRESH_INTERVAL`
- `refreshTimer = setInterval(refresh, REFRESH_INTERVAL * 1000)`

**Event listeners:**
```javascript
// Close modal on X button click
modalClose.addEventListener("click", closeModal);

// Close modal on clicking outside the modal content
coinModal.addEventListener("click", (e) => {
    if (e.target === coinModal) closeModal();
});

// Close modal on Escape key
document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") closeModal();
});

// Re-fetch when top-N selection changes
topNSelect.addEventListener("change", refresh);
```

**Initialization:**
```javascript
// Initial load
refresh();
startAutoRefresh();
```

**Important notes:**
- Use `encodeURIComponent` on the symbol in the coin detail fetch URL to handle edge cases
- Use `toLocaleString("en-US", ...)` for consistent number formatting across browsers
- Error handling inside refresh() — a failed fetch should not break the auto-refresh loop
- Modal closes on: X button click, clicking outside the modal, pressing Escape
- No external dependencies — vanilla JS, no jQuery, no React, no bundler
- Do NOT use innerHTML for user-controlled content unsafely — coin data from our own API is safe
  </action>
  <verify>
    <automated>cd /home/james-turing/repos/crypto-price-tracker-v2 && test -f src/crypto_price_tracker/static/app.js && grep -q "fetchPrices" src/crypto_price_tracker/static/app.js && grep -q "showCoinDetail" src/crypto_price_tracker/static/app.js && grep -q "setInterval" src/crypto_price_tracker/static/app.js && echo "PASS" || echo "FAIL"</automated>
  </verify>
  <done>app.js fetches from /api/prices and /api/coin/{symbol}, renders the price table with color-coded changes, auto-refreshes every 30 seconds via setInterval, shows coin detail in a modal on row click, and handles errors gracefully. All functionality is vanilla JavaScript with no external dependencies.</done>
</task>

</tasks>

<verification>
Run these commands sequentially to verify the plan is complete:

1. `test -f src/crypto_price_tracker/static/index.html` — HTML file exists
2. `test -f src/crypto_price_tracker/static/style.css` — CSS file exists
3. `test -f src/crypto_price_tracker/static/app.js` — JS file exists
4. `grep -q "api/prices" src/crypto_price_tracker/static/app.js` — JS fetches prices endpoint
5. `grep -q "api/coin" src/crypto_price_tracker/static/app.js` — JS fetches coin detail endpoint
6. `grep -q "setInterval" src/crypto_price_tracker/static/app.js` — Auto-refresh is implemented
7. `grep -q "change-positive" src/crypto_price_tracker/static/style.css` — Green styling exists
8. `grep -q "change-negative" src/crypto_price_tracker/static/style.css` — Red styling exists
9. `/home/james-turing/.local/bin/uv run pytest tests/ -v` — All tests (existing + new) still pass
10. Manual: Start `crypto web`, open http://localhost:8000, verify table loads and auto-refreshes
</verification>

<success_criteria>
1. Opening http://localhost:8000 shows a styled dark-theme price table with all columns
2. Prices load automatically on page open (no manual action needed)
3. Table shows rank, symbol, name, EUR price, color-coded 24h %, and EUR volume
4. Positive 24h changes are green, negative are red, zero is grey
5. Clicking a coin row opens a modal with detailed coin information
6. Modal closes on X button, clicking outside, or pressing Escape
7. The "Show top" dropdown changes the number of coins displayed
8. Prices auto-refresh every 30 seconds without page reload
9. Network errors show a status message but do not break the refresh loop
10. Dashboard is readable on mobile (volume column hidden on small screens)
</success_criteria>

<output>
After completion, create `.planning/phases/04-web-dashboard/04-02-SUMMARY.md`
</output>
